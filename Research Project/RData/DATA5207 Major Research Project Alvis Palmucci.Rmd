---
title: 'DATA5207: Major Research Project'
author: "Alvis Palmucci | 460270999"
date: "17 June 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(caret)
library(mlbench)
library(fBasics)
library(corrplot)
library(tidyverse)
library(broom)
library(pscl)
library(MASS)
library(fBasics)
#Set working directory
setwd('C:\\Users\\Alvis\\Documents\\GitHub\\DATA5207\\Research Project\\RData')
getwd()

#Read in the data
dv <- read.csv("DV_NSW_by_LGA.csv", header=TRUE, sep=',', na.strings="")
labels <- read.csv("labels.csv", header=TRUE, sep=',', na.strings="")
labels_data <- read.csv("NSW_LGA.csv", header=TRUE, sep=',', na.strings="")

#Merge data and labels based on LGA id
data.merge <- merge(dv, labels_data, by="region_id")
write.csv(data.merge, 'RData.data.merge.csv')

#Sum monthly domestic violence data into yearly data
data.years <- data.frame( yr1999_dv = apply(data.merge[3:14], 1, sum) ,
                      yr2000_dv = apply(data.merge[15:26], 1, sum), 
                      yr2001_dv = apply(data.merge[27:38], 1, sum),
                      yr2002_dv = apply(data.merge[39:50], 1, sum),
                      yr2003_dv = apply(data.merge[51:62], 1, sum),
                      yr2004_dv = apply(data.merge[63:74], 1, sum),
                      yr2005_dv = apply(data.merge[75:86], 1, sum),
                      yr2006_dv = apply(data.merge[87:98], 1, sum),
                      yr2007_dv = apply(data.merge[99:110], 1, sum),
                      yr2008_dv = apply(data.merge[111:122], 1, sum),
                      yr2009_dv = apply(data.merge[123:134], 1, sum),
                      yr2010_dv = apply(data.merge[135:146], 1, sum),
                      yr2011_dv = apply(data.merge[147:158], 1, sum),
                      yr2012_dv = apply(data.merge[159:170], 1, sum),
                      yr2013_dv = apply(data.merge[171:182], 1, sum),
                      yr2014_dv = apply(data.merge[183:194], 1, sum),
                      yr2015_dv = apply(data.merge[195:206], 1, sum),
                      yr2016_dv = apply(data.merge[207], 1, sum))

#Rename rows to names and region_id labels
data.bind <- cbind(data.years, data.merge[,1:2])
write.csv(data.bind, 'RData.data.bind.csv')

#Re-order column labels
data.order.dv <- data.bind[,c(20,19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]
write.csv(data.order.dv, 'RData.data.order.csv')


#Now we need to match the domestic violence LGA's to the newly mapped LGA's
#So we need to sum the values of the relevant rows that make up these new LGA regions
#Check row and column LGA indicies
nrow(data.order.dv) #140 rows
ncol(data.order.dv) #20 columns


#Sum data for Canterbury-Bankstown (A): Bankstown and Canterbury Councils
#Select only relevant councils
CanterburyBankstown <- data.order.dv[c(6,25),3:20]
#Sum data from relevant councils
CanterburyBankstown_LGA <- rbind(CanterburyBankstown, c(t(apply(CanterburyBankstown[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
CanterburyBankstown_LGA["LGA"] <- "Canterbury-Bankstown (A)"
#Select summed row
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[3,]
#Reorder columns
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Snowy Monaro Regional (A): Bombala, Cooma-Monaro and Snowy River Shires
data.order.dv[,1]
#Bombala Shire Council does not exist in the Domestic Violence data set and hence Cooma-Monaro and Snowy River
#Shires are excluded from the analysis


#Sum data for Hilltops (A): Boorowa Council, Harden Shire and Young Shire
data.order.dv[,1]
#Boorowa Council does not exist in the Domestic Violence data set and hence Harden Shire and Young Shire
#are excluded from the analysis


#Sum data for Central Coast (C) (NSW): Gosford City and Wyong Shire
data.order.dv[,1]
#Select only relevant councils
CentralCoast <- data.order.dv[c(45,138),3:20]
#Sum data from relevant councils
CentralCoast_LGA <- rbind(CentralCoast, c(t(apply(CentralCoast[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
CentralCoast_LGA["LGA"] <- "Central Coast (C) (NSW)"
#Select summed row
CentralCoast_LGA <- CentralCoast_LGA[3,]
#Reorder columns
CentralCoast_LGA <- CentralCoast_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Edward River (A): Deniliquin Council and Conargo Shire
data.order.dv[,1]
#Conargo Shire does not exist in the Domestic Violence data set and hence Deniliquin Council is excluded from
#the analysis


#Sum data for Federation (A): Corowa Shire, Lockhart and Urana shires
data.order.dv[,1]
#Urana Shire does not exist in the Domestic Violence data set and hence Corowa and Lockhart Shires are excluded from
#the analysis


#Sum data for Western Plains Regional (A): City of Dubbo and Wellington Council
data.order.dv[,1]
#Select only relevant councils
WesternPlains <- data.order.dv[c(37,131),3:20]
#Sum data from relevant councils
WesternPlains_LGA <- rbind(WesternPlains, c(t(apply(WesternPlains[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
WesternPlains_LGA["LGA"] <- "Western Plains Regional (A)"
#Select summed row
WesternPlains_LGA <- WesternPlains_LGA[3,]
#Reorder columns
WesternPlains_LGA <- WesternPlains_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Cumberland (A): parts of Auburn City, the former Parramatta City (Woodville Ward), and Holroyd City Councils
data.order.dv[,1]
#Not possible to break out parts of different councils, so Auburn and Holroyd City Councils are excluded from
#the analysis


#Sum data for Georges River (A): Kogarah City Council and Hurstville City Council
data.order.dv[,1]
#Select only relevant councils
GeorgesRiver <- data.order.dv[c(66,61),3:20]
#Sum data from relevant councils
GeorgesRiver_LGA <- rbind(GeorgesRiver, c(t(apply(GeorgesRiver[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
GeorgesRiver_LGA["LGA"] <- "Georges River (A)"
#Select summed row
GeorgesRiver_LGA <- GeorgesRiver_LGA[3,]
#Reorder columns
GeorgesRiver_LGA <- GeorgesRiver_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Mid-Coast (A): Gloucester Shire, Great Lakes and City of Greater Taree Councils
data.order.dv[,1]
#Select only relevant councils
MidCoast <- data.order.dv[c(44,47,49),3:20]
#Sum data from relevant councils
MidCoast_LGA <- rbind(MidCoast, c(t(apply(MidCoast[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
MidCoast_LGA["LGA"] <- "Mid-Coast (A)"
#Select summed row
MidCoast_LGA <- MidCoast_LGA[4,]
#Reorder columns
MidCoast_LGA <- MidCoast_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Armidale Regional (A): Armidale Dumaresq Shire and Guyra Shire
data.order.dv[,1]
#Select only relevant councils
ArmidaleRegional <- data.order.dv[c(2,53),3:20]
#Sum data from relevant councils
ArmidaleRegional_LGA <- rbind(ArmidaleRegional, c(t(apply(ArmidaleRegional[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
ArmidaleRegional_LGA["LGA"] <- "Armidale Regional (A)"
#Select summed row
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[3,]
#Reorder columns
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Inner West (A): Ashfield, Leichhardt, and Marrickville Councils
data.order.dv[,1]
#Select only relevant councils
InnerWest <- data.order.dv[c(3,73,81),3:20]
#Sum data from relevant councils
InnerWest_LGA <- rbind(InnerWest, c(t(apply(InnerWest[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
InnerWest_LGA["LGA"] <- "Inner West (A)"
#Select summed row
InnerWest_LGA <- InnerWest_LGA[4,]
#Reorder columns
InnerWest_LGA <- InnerWest_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Murrumbidgee (A): Municipality of Jerilderie and Wunnamurra Shire
data.order.dv[,1]
#Does not exist in the Domestic Violence data set and hence Municipality of Jerilderie and Wunnamurra Shire
#are excluded from the analysis


#Sum data for Northern Beaches (A): Manly, Pittwater and Warringah Councils
data.order.dv[,1]
#Select only relevant councils
Northern_Beaches <- data.order.dv[c(80,99,127),3:20]
#Sum data from relevant councils
Northern_Beaches_LGA <- rbind(Northern_Beaches, c(t(apply(Northern_Beaches[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
Northern_Beaches_LGA["LGA"] <- "Northern Beaches (A)"
#Select summed row
Northern_Beaches_LGA <- Northern_Beaches_LGA[4,]
#Reorder columns
Northern_Beaches_LGA <- Northern_Beaches_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Murray River (A): Murray Shire with Wakool Shire
data.order.dv[,1]
#Select only relevant councils
MurrayRiver <- data.order.dv[c(85,124),3:20]
#Sum data from relevant councils
MurrayRiver_LGA <- rbind(MurrayRiver, c(t(apply(MurrayRiver[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
MurrayRiver_LGA["LGA"] <- "Murray River (A)"
#Select summed row
MurrayRiver_LGA <- MurrayRiver_LGA[3,]
#Reorder columns
MurrayRiver_LGA <- MurrayRiver_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Sum data for Snowy Valleys (A): Tumbarumba Shire and Tumut Shire councils
data.order.dv[,1]
#Select only relevant councils
SnowyValleys <- data.order.dv[c(117,118),3:20]
#Sum data from relevant councils
SnowyValleys_LGA <- rbind(SnowyValleys, c(t(apply(SnowyValleys[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
SnowyValleys_LGA["LGA"] <- "Snowy Valleys (A)"
#Select summed row
SnowyValleys_LGA <- SnowyValleys_LGA[3,]
#Reorder columns
SnowyValleys_LGA <- SnowyValleys_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]


#Run data for Queanbeyan-Palerang Regional (A). City of Queanbeyan and Palerang Council,
data.order.dv[,1]
#Select only relevant councils
Queanbeyan <- data.order.dv[c(102,95),3:20]
#Sum data from relevant councils
Queanbeyan_LGA <- rbind(Queanbeyan, c(t(apply(Queanbeyan[,1:18], 2, sum, na.rm=TRUE))))
#Create new LGA name column
Queanbeyan_LGA["LGA"] <- "Queanbeyan-Palerang Regional (A)"
#Select summed row
Queanbeyan_LGA <- Queanbeyan_LGA[3,]
#Reorder columns
Queanbeyan_LGA <- Queanbeyan_LGA[,c(19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]



#Now we need to remove the old councils from the original data sets so they match the new LGA regions
data.order.dv.edit <- data.order.dv[c(-6,-25,-45,-138,-37,-131,-66,-61,-44,-49,-47,-2,-53,-3,-73,-81,-80,
                                     -99,-127,-85,-124,-117,-118,-102,-95),1:20]
#Revised count of rows
nrow(data.order.dv.edit) #115 rows
ncol(data.order.dv.edit) #20 columns


#Now that we have summed up the new LGA regions, we need to add in the unique LGA region id and
#add them back into the original data set
CanterburyBankstown_LGA$region_id <- "LGA11570"
colnames(CanterburyBankstown_LGA)
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


CentralCoast_LGA$region_id <- "LGA11650"
colnames(CentralCoast_LGA)
CentralCoast_LGA <- CentralCoast_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


WesternPlains_LGA$region_id <- "LGA18230"
colnames(WesternPlains_LGA)
WesternPlains_LGA <- WesternPlains_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


GeorgesRiver_LGA$region_id <- "LGA12930"
colnames(GeorgesRiver_LGA)
GeorgesRiver_LGA <- GeorgesRiver_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


MidCoast_LGA$region_id <- "LGA15240"
colnames(ArmidaleRegional_LGA)
MidCoast_LGA <- MidCoast_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


ArmidaleRegional_LGA$region_id <- "LGA10130"
colnames(ArmidaleRegional_LGA)
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


InnerWest_LGA$region_id <- "LGA14170"
colnames(InnerWest_LGA)
InnerWest_LGA <- InnerWest_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


Northern_Beaches_LGA$region_id <- "LGA15990"
colnames(Northern_Beaches_LGA)
Northern_Beaches_LGA <- Northern_Beaches_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


MurrayRiver_LGA$region_id <- "LGA15520"
colnames(MurrayRiver_LGA)
MurrayRiver_LGA <- MurrayRiver_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


SnowyValleys_LGA$region_id <- "LGA17080"
colnames(SnowyValleys_LGA)
SnowyValleys_LGA <- SnowyValleys_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]


Queanbeyan_LGA$region_id <- "LGA16490"
colnames(Queanbeyan_LGA)
Queanbeyan_LGA <- Queanbeyan_LGA[,c(1,20,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)]

#Row bind the LGA regions together
data.order.dv.new <- rbind(data.order.dv.edit
                           ,CanterburyBankstown_LGA
                           ,CentralCoast_LGA
                           ,WesternPlains_LGA
                           ,GeorgesRiver_LGA
                           ,MidCoast_LGA
                           ,ArmidaleRegional_LGA
                           ,InnerWest_LGA
                           ,Northern_Beaches_LGA
                           ,MurrayRiver_LGA
                           ,SnowyValleys_LGA
                           ,Queanbeyan_LGA
)


#Check new data frame
nrow(data.order.dv.new) #126 rows
ncol(data.order.dv.new) #20 columns


#Now that we have aggregated the new amalgamated councils into the data set, we now need to remove
#those individual Council regions which could not be matched
data.order.dv.final <- data.order.dv.new[-c(2,27,30,32,45,48,65,91,115),]
data.order.dv.final[,1:2]
nrow(data.order.dv.final) #117 rows
ncol(data.order.dv.final) #20 columns
write.csv(data.order.dv.final, 'RData.data.order.dv.final.csv')

##It is necessary at this point to check the domestic violence distributions for each LGA to ensure the numbers
#are not being skewed by very large or very small population areas and ideally fall with the IQR
#Average domestic violence for each LGA across years 1999 to 2015
data.order.dv.final$dv_mean <- as.integer(round(rowMeans(data.order.dv.final[,3:20])))

#Investigate LGA populations for outliers
summary <- summary(data.order.dv.final$dv_mean)
summary

#LGA Regions less than first quartile
data.order.dv.final_quart_1 = data.order.dv.final[!(data.order.dv.final$dv_mean < 37),]
nrow(data.order.dv.final_quart_1) #88 rows

#LGA Regions greater than third quartile
data.order.dv.final = data.order.dv.final_quart_1[!(data.order.dv.final_quart_1$dv_mean > 238),]
nrow(data.order.dv.final) #59
data.order.dv.final <- data.order.dv.final[,-c(21)]
write.csv(data.order.dv.final, 'data.order.dv.final.csv')

### Population count by LGA regions ###
#Due to 2016 council mergers a number of LGA council regions were amalgamated.
#Refer to document with referenced councils.
#An estimated residential population has been provided for each year.
#Because of this amalgamation and the different council regions the original data on the
#domestic violence council areas needs to be updated (merge different rows)
total.pop.count <- read.csv("LGA_Population_Mapping.csv", header=TRUE, sep=',', na.strings="")
total.pop.count <- total.pop.count[,2:20]

#Now we need to inner join the domestic violence data set to the Total Population data set.
#This will allow us to calculate percentages of the population to ensure relativity across LGA regions
#respective of the population
nrow(data.order.dv.final) #59 rows
ncol(data.order.dv.final) #20 columns


nrow(total.pop.count) #128 rows
ncol(total.pop.count) #19 columns

dv_pop <- join(data.order.dv.final, total.pop.count, type="inner", by="region_id")

nrow(dv_pop) #58 rows
ncol(dv_pop) #38 columns
write.csv(dv_pop, 'RData.dv_pop.csv')


### Calculate domestic violence incidents as percentage of total population ###
dv_pop$yr1999pct <- (dv_pop$yr1999_dv/dv_pop$yr1999_pop)
dv_pop$yr2000pct <- (dv_pop$yr2000_dv/dv_pop$yr2000_pop)
dv_pop$yr2001pct <- (dv_pop$yr2001_dv/dv_pop$yr2001_pop)
dv_pop$yr2002pct <- (dv_pop$yr2002_dv/dv_pop$yr2002_pop)
dv_pop$yr2003pct <- (dv_pop$yr2003_dv/dv_pop$yr2003_pop)
dv_pop$yr2004pct <- (dv_pop$yr2004_dv/dv_pop$yr2004_pop)
dv_pop$yr2005pct <- (dv_pop$yr2005_dv/dv_pop$yr2005_pop)
dv_pop$yr2006pct <- (dv_pop$yr2006_dv/dv_pop$yr2006_pop)
dv_pop$yr2007pct <- (dv_pop$yr2007_dv/dv_pop$yr2007_pop)
dv_pop$yr2008pct <- (dv_pop$yr2008_dv/dv_pop$yr2008_pop)
dv_pop$yr2009pct <- (dv_pop$yr2009_dv/dv_pop$yr2009_pop)
dv_pop$yr2010pct <- (dv_pop$yr2010_dv/dv_pop$yr2010_pop)
dv_pop$yr2011pct <- (dv_pop$yr2011_dv/dv_pop$yr2011_pop)
dv_pop$yr2012pct <- (dv_pop$yr2012_dv/dv_pop$yr2012_pop)
dv_pop$yr2013pct <- (dv_pop$yr2013_dv/dv_pop$yr2013_pop)
dv_pop$yr2014pct <- (dv_pop$yr2014_dv/dv_pop$yr2014_pop)
dv_pop$yr2015pct <- (dv_pop$yr2015_dv/dv_pop$yr2015_pop)
dv_pop$yr2016pct <- (dv_pop$yr2016_dv/dv_pop$yr2016_pop)

write.csv(dv_pop,'RData.dv_pop.csv')


LGA_labels_2016 <- read.csv('region_id_to_LGA_2016.csv', header=TRUE, sep=',', na.strings="")

#Merge dataset to bring in correct and full LGA label
dv_pop_label <- join(x = dv_pop, y = LGA_labels_2016, type="inner", by='region_id')
dv_pop_label <- dv_pop_label[,-c(1)] #Remove short LGA label
write.csv(dv_pop_label,'RData.dv_pop_label.csv')

#Reorder data frame
dv_pop_order <- dv_pop_label[,c(56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,27,29,30
                                ,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55)]
write.csv(dv_pop_order,'RData.dv_pop_order.csv')


##It is necessary at this point to check the population distributions for each LGA to ensure the numbers
#are not being skewed by very large or very small population areas
#Average population for each LGA across years 1999 to 2016
total.pop.count$pop_mean <- as.integer(round(rowMeans(total.pop.count[,2:19])))

#Investigate LGA populations for outliers
summary <- summary(total.pop.count$pop_mean)
summary


#Remove LGA region outliers from domestic violence dataframe
dv_pop_order_quart_1 = total.pop.count[!(total.pop.count$pop_mean < 8822),]
nrow(dv_pop_order_quart_1) #96 rows

dv_pop_order_quart_3 = dv_pop_order_quart_1[!(dv_pop_order_quart_1$pop_mean > 65883),]
nrow(dv_pop_order_quart_3) #64

dv_pop_order <- join(dv_pop_order, dv_pop_order_quart_3, by="region_id", type="inner")
dv_pop_order <- dv_pop_order[,-c(57:75)]
write.csv(dv_pop_order, 'dv_pop_order.csv')



#The LGA regions for the independent variables will now need to match the domestic violence LGA region list, so
#below we will go through and sum the values of the relevant rows that make up these domestic violence LGA regions

#Sum data for Canterbury-Bankstown (A): Bankstown and Canterbury Councils
#Select only relevant councils
CanterburyBankstown <- labels_data[c(7,29),5:7946]
#Sum data from relevant councils
CanterburyBankstown_LGA <- rbind(CanterburyBankstown, c(t(apply(CanterburyBankstown[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
CanterburyBankstown_LGA["LGA"] <- "Canterbury-Bankstown (A)"
#Select summed row
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[3,]
#Reorder columns
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[,c(7943,1:7942)]


#Sum data for Central Coast (C) (NSW): Gosford City and Wyong Shire
#Select only relevant councils
CentralCoast <- labels_data[c(52,150),5:7946]
#Sum data from relevant councils
CentralCoast_LGA <- rbind(CentralCoast, c(t(apply(CentralCoast[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
CentralCoast_LGA["LGA"] <- "Central Coast (C) (NSW)"
#Select summed row
CentralCoast_LGA <- CentralCoast_LGA[3,]
#Reorder columns
CentralCoast_LGA <- CentralCoast_LGA[,c(7943,1:7942)]


#Sum data for Western Plains Regional (A): City of Dubbo and Wellington Council
#Select only relevant councils
WesternPlains <- labels_data[c(44,143),5:7946]
#Sum data from relevant councils
WesternPlains_LGA <- rbind(WesternPlains, c(t(apply(WesternPlains[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
WesternPlains_LGA["LGA"] <- "Western Plains Regional (A)"
#Select summed row
WesternPlains_LGA <- WesternPlains_LGA[3,]
#Reorder columns
WesternPlains_LGA <- WesternPlains_LGA[,c(7943,1:7942)]


#Sum data for Georges River (A): Kogarah City Council and Hurstville City Council
#Select only relevant councils
GeorgesRiver <- labels_data[c(74,68),5:7946]
#Sum data from relevant councils
GeorgesRiver_LGA <- rbind(GeorgesRiver, c(t(apply(GeorgesRiver[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
GeorgesRiver_LGA["LGA"] <- "Georges River (A)"
#Select summed row
GeorgesRiver_LGA <- GeorgesRiver_LGA[3,]
#Reorder columns
GeorgesRiver_LGA <- GeorgesRiver_LGA[,c(7943,1:7942)]


#Sum data for Mid-Coast (A): Gloucester Shire, Great Lakes and City of Greater Taree Councils
#Select only relevant councils
MidCoast <- labels_data[c(51,54,56),5:7946]
#Sum data from relevant councils
MidCoast_LGA <- rbind(MidCoast, c(t(apply(MidCoast[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
MidCoast_LGA["LGA"] <- "Mid-Coast (A)"
#Select summed row
MidCoast_LGA <- MidCoast_LGA[4,]
#Reorder columns
MidCoast_LGA <- MidCoast_LGA[,c(7943,1:7942)]


#Sum data for Armidale Regional (A): Armidale Dumaresq Shire and Guyra Shire
#Select only relevant councils
ArmidaleRegional <- labels_data[c(2,60),5:7946]
#Sum data from relevant councils
ArmidaleRegional_LGA <- rbind(ArmidaleRegional, c(t(apply(ArmidaleRegional[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
ArmidaleRegional_LGA["LGA"] <- "Armidale Regional (A)"
#Select summed row
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[3,]
#Reorder columns
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[,c(7943,1:7942)]


#Sum data for Inner West (A): Ashfield, Leichhardt, and Marrickville Councils
#Select only relevant councils
InnerWest <- labels_data[c(3,81,89),5:7946]
#Sum data from relevant councils
InnerWest_LGA <- rbind(InnerWest, c(t(apply(InnerWest[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
InnerWest_LGA["LGA"] <- "Inner West (A)"
#Select summed row
InnerWest_LGA <- InnerWest_LGA[4,]
#Reorder columns
InnerWest_LGA <- InnerWest_LGA[,c(7943,1:7942)]


#Sum data for Northern Beaches (A): Manly, Pittwater and Warringah Councils
#Select only relevant councils
Northern_Beaches <- labels_data[c(88,108,139),5:7946]
#Sum data from relevant councils
Northern_Beaches_LGA <- rbind(Northern_Beaches, c(t(apply(Northern_Beaches[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
Northern_Beaches_LGA["LGA"] <- "Northern Beaches (A)"
#Select summed row
Northern_Beaches_LGA <- Northern_Beaches_LGA[4,]
#Reorder columns
Northern_Beaches_LGA <- Northern_Beaches_LGA[,c(7943,1:7942)]


#Sum data for Murray River (A): Murray Shire with Wakool Shire
#Select only relevant councils
MurrayRiver <- labels_data[c(93,135),5:7946]
#Sum data from relevant councils
MurrayRiver_LGA <- rbind(MurrayRiver, c(t(apply(MurrayRiver[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
MurrayRiver_LGA["LGA"] <- "Murray River (A)"
#Select summed row
MurrayRiver_LGA <- MurrayRiver_LGA[3,]
#Reorder columns
MurrayRiver_LGA <- MurrayRiver_LGA[,c(7943,1:7942)]


#Sum data for Snowy Valleys (A): Tumbarumba Shire and Tumut Shire councils
#Select only relevant councils
SnowyValleys <- labels_data[c(127,128),5:7946]
#Sum data from relevant councils
SnowyValleys_LGA <- rbind(SnowyValleys, c(t(apply(SnowyValleys[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
SnowyValleys_LGA["LGA"] <- "Snowy Valleys (A)"
#Select summed row
SnowyValleys_LGA <- SnowyValleys_LGA[3,]
#Reorder columns
SnowyValleys_LGA <- SnowyValleys_LGA[,c(7943,1:7942)]


#Run data for Queanbeyan-Palerang Regional (A). City of Queanbeyan and Palerang Council,
#Select only relevant councils
Queanbeyan <- labels_data[c(111,104),5:7946]
#Sum data from relevant councils
Queanbeyan_LGA <- rbind(Queanbeyan, c(t(apply(Queanbeyan[,1:7942], 2, sum, na.rm=TRUE))))
#Create new LGA name column
Queanbeyan_LGA["LGA"] <- "Queanbeyan-Palerang Regional (A)"
#Select summed row
Queanbeyan_LGA <- Queanbeyan_LGA[3,]
#Reorder columns
Queanbeyan_LGA <- Queanbeyan_LGA[,c(7943,1:7942)]


##Now we need to remove the old councils from the independent data sets so they match the new LGA regions
labels_data_edit <- labels_data[c(-2,-3,-4,-6,-7,-17,-18,-21,-29,-30,-31,-36,-38,-40,-41,-43,-44,-51,-52,-54,
                                -56,-58,-60,-62,-65,-68,-70,-74,-81,-86,-88,-89,-93,-94,-104,-106,-108,-111,
                                -119,-122,-127,-128,-133,-135,-138,-139,-143,-150,-152,-153,-154),c(1:2,5:7946)]

#Revised count of rows
nrow(labels_data_edit) #103 rows
ncol(labels_data_edit) #7944 columns

#Reorder columns
labels_data_edit_order <- labels_data_edit[,c(2,1, 3:7944)]
labels_data_edit_order$LGA <- labels_data_edit_order$label
labels_data_edit_order <- labels_data_edit_order[,c(-1), c(2:7945)]
labels_data_edit_order <- labels_data_edit_order[,c(7944,1:7943)]
write.csv(labels_data_edit_order, 'labels_data_edit_order.csv')


#Now that we have summed up the new LGA regions, we need to add in the unique LGA region id and
#add them back into the original data set
CanterburyBankstown_LGA$region_id <- "LGA11570"
CanterburyBankstown_LGA <- CanterburyBankstown_LGA[,c(1,7944,2:7943)]

CentralCoast_LGA$region_id <- "LGA11650"
CentralCoast_LGA <- CentralCoast_LGA[,c(1,7944,2:7943)]

WesternPlains_LGA$region_id <- "LGA18230"
WesternPlains_LGA <- WesternPlains_LGA[,c(1,7944,2:7943)]

GeorgesRiver_LGA$region_id <- "LGA12930"
GeorgesRiver_LGA <- GeorgesRiver_LGA[,c(1,7944,2:7943)]

MidCoast_LGA$region_id <- "LGA15240"
MidCoast_LGA <- MidCoast_LGA[,c(1,7944,2:7943)]

ArmidaleRegional_LGA$region_id <- "LGA10130"
ArmidaleRegional_LGA <- ArmidaleRegional_LGA[,c(1,7944,2:7943)]

InnerWest_LGA$region_id <- "LGA14170"
InnerWest_LGA <- InnerWest_LGA[,c(1,7944,2:7943)]

Northern_Beaches_LGA$region_id <- "LGA15990"
Northern_Beaches_LGA <- Northern_Beaches_LGA[,c(1,7944,2:7943)]

MurrayRiver_LGA$region_id <- "LGA15520"
MurrayRiver_LGA <- MurrayRiver_LGA[,c(1,7944,2:7943)]

SnowyValleys_LGA$region_id <- "LGA17080"
SnowyValleys_LGA <- SnowyValleys_LGA[,c(1,7944,2:7943)]

Queanbeyan_LGA$region_id <- "LGA16490"
Queanbeyan_LGA <- Queanbeyan_LGA[,c(1,7944,2:7943)]


#Now we can add in the new LGA regions into the independent variable dataset
labels_data.new <- rbind(labels_data_edit_order
                           ,CanterburyBankstown_LGA
                           ,CentralCoast_LGA
                           ,WesternPlains_LGA
                           ,GeorgesRiver_LGA
                           ,MidCoast_LGA
                           ,ArmidaleRegional_LGA
                           ,InnerWest_LGA
                           ,Northern_Beaches_LGA
                           ,MurrayRiver_LGA
                           ,SnowyValleys_LGA
                           ,Queanbeyan_LGA
                         )

write.csv(labels_data.new, 'labels_data.new.csv')



### Independent variables
#Percentage of Population by age groups (2011 Census)
#Get data
young_women_data <- labels_data.new[, c("region_id", "LGA", "B911", "B912", "B914", "B915", "B923",
                                        "B924", "B926", "B927", "B935", "B936", "B938", "B939", "B947",
                                        "B948", "B950", "B951", "B959", "B960", "B962", "B963", "B971",
                                        "B972", "B974", "B975", "B983", "B984", "B986", "B987", "B995",
                                        "B996", "B998", "B999", "B1007", "B1008", "B1010", "B1011",
                                        "B1019", "B1020", "B1022", "B1023", "B1040", "B1041", "B1042"
)]


#Total Males and Females
young_women_data$males_ppt <- (young_women_data$B1040/young_women_data$B1042)
young_women_data$females_ppt <- (young_women_data$B1041/young_women_data$B1042)
young_women_data <- young_women_data[,c(1:2,46:47)]
write.csv(young_women_data, 'young_women_data.csv')


#Percentage of Population born in non_English speaking countries (2011 Census)
#Get data
born_overseas_data <- labels_data.new[, c("region_id", "LGA", "B1247", "B1248", "B1358", "B1359")]

#Sum data for each row variable
born_overseas_data$Total <- rowSums(born_overseas_data[, c(5:6)])
born_overseas_data$Total <- as.integer(as.double(born_overseas_data$Total))
born_overseas_data$Total <- as.integer(as.double(born_overseas_data$Total))
born_overseas_data$male_birth_os <- (born_overseas_data$B1358-born_overseas_data$B1247)
born_overseas_data$female_birth_os <- (born_overseas_data$B1359-born_overseas_data$B1248)
born_overseas_data$male_birth_au_ppt <- (born_overseas_data$B1247/born_overseas_data$Total)
born_overseas_data$female_birth_au_ppt <- (born_overseas_data$B1248/born_overseas_data$Total)
born_overseas_data$male_birth_os_ppt <- (born_overseas_data$male_birth_os/born_overseas_data$Total)
born_overseas_data$female_birth_os_ppt <- (born_overseas_data$female_birth_os/born_overseas_data$Total)


#Percentage of Population who are Indigenous and Non-Indigenous (2011 Census)
#Get data
indigenous_data <- labels_data.new[, c("region_id", "LGA", "B1031", "B1032", "B1034", "B1035")]

#Sum data for each row variable
indigenous_data$Total <- rowSums(indigenous_data[, c(3:6)])
indigenous_data$Total <- as.integer(as.double(indigenous_data$Total))

indigenous_data$Total_Indig_Males_ppt <- (indigenous_data$B1031/indigenous_data$Total)
indigenous_data$Total_Indig_Females_ppt <- (indigenous_data$B1032/indigenous_data$Total)
indigenous_data$Total_Non_Indig_Males_ppt <- (indigenous_data$B1034/indigenous_data$Total)
indigenous_data$Total_Non_Indig_Females_ppt <- (indigenous_data$B1035/indigenous_data$Total)


#Percentage of Population who are sole parents (2011 Census)
#Get data
sole_parents_data <- labels_data.new[, c("region_id", "LGA", "B4953", "B4954", "B4955")]

#Sum data for each row variable
sole_parents_data$Total <- rowSums(sole_parents_data[, c(3:5)])
sole_parents_data$Total <- as.integer(as.double(sole_parents_data$Total))

sole_parents_data$Coup_Fam_No_Child_ppt <- (sole_parents_data$B4953/sole_parents_data$Total)
sole_parents_data$Coup_Fam_W_Child_ppt <- (sole_parents_data$B4954/sole_parents_data$Total)
sole_parents_data$Sole_Parent_ppt <- (sole_parents_data$B4955/sole_parents_data$Total)


#Percentage of rental population (2011 Census)
#Get data
rental_data <- labels_data.new[, c("region_id", "LGA", "B5100", "B5106")]

#Sum data for each row variable
rental_data$Total <- rowSums(rental_data[, c(3:4)])
rental_data$Total <- as.integer(as.double(rental_data$Total))

rental_data$Private_ppt <- (rental_data$B5100/rental_data$Total)
rental_data$Government_ppt <- (rental_data$B5106/rental_data$Total)


#Percentage of unemployed male population (2011 Census)
#Get data
unemployment_data <- labels_data.new[, c("region_id", "LGA", "B5495", "B5496")]

#Sum data for each row variable
unemployment_data$Unemployment_Male_ppt <- (unemployment_data$B5495/100)
unemployment_data$Unemployment_Female_ppt <- (unemployment_data$B5496/100)


#Percentage of different address one year ago (2011 Census)
#Get data
address_data <- labels_data.new[, c("region_id", "LGA", "B5531", "B5532", "B5573", "B5574")]

#Sum data for each row variable
address_data$Total <- rowSums(address_data[, c(3:6)])
address_data$Total <- as.integer(as.double(address_data$Total))

address_data$same_add_males_ppt <- (address_data$B5531/address_data$Total)
address_data$same_add_females_ppt <- (address_data$B5532/address_data$Total)
address_data$diff_add_males_ppt <- (address_data$B5573/address_data$Total)
address_data$diff_add_females_ppt <- (address_data$B5574/address_data$Total)


#Percentage of population income levels (2011 Census)
#Get data
income_data <- labels_data.new[, c("region_id", "LGA", "B3393", "B3403", "B3413", "B3423", "B3433", "B3443", "B3453", "B3463", "B3473",
                               "B3483", "B3493")]

#Sum data for each row variable
income_data$Total <- rowSums(income_data[, c(3:13)])
income_data$Total <- as.integer(as.double(income_data$Total))

income_data$Nil_Income_ppt <- (income_data$B3393/income_data$Total)
income_data$x100_199_ppt <- (income_data$B3403/income_data$Total)

income_data$x200_299_ppt <- (income_data$B3413/income_data$Total)
income_data$x300_399_ppt <- (income_data$B3423/income_data$Total)
income_data$x400_599ppt <- (income_data$B3433/income_data$Total)
income_data$x600_799ppt <- (income_data$B3443/income_data$Total)

income_data$x800_999ppt <- (income_data$B3453/income_data$Total)
income_data$x1000_1249ppt <- (income_data$B3463/income_data$Total)
income_data$x1250_1499ppt <- (income_data$B3473/income_data$Total)
income_data$x1500_1999ppt <- (income_data$B3483/income_data$Total)
income_data$x2000_plusppt <- (income_data$B3493/income_data$Total)


#Create merged income group
#Weekly Income x200-799
income_data$x200_799 <- rowSums(income_data[,c('B3413','B3423','B3433','B3443')])
income_data$x200_799_ppt <- rowSums(income_data[,c('B3413','B3423','B3433','B3443')]/income_data$Total)

#Create merged income group
#Weekly Income x800-1249
income_data$x800_1249 <- rowSums(income_data[,c('B3453','B3463')])
income_data$x800_1249_ppt <- rowSums(income_data[,c('B3453','B3463')]/income_data$Total)

#Create merged income group
#Weekly Income x1500_plus
income_data$x1500_plus <- rowSums(income_data[,c('B3483','B3493')])
income_data$x1500_plus_ppt <- rowSums(income_data[,c('B3483','B3493')]/income_data$Total)


###Summary of dataframes after data manipulation
#Dependent variables
write.csv(dv_pop_order, "dv_pop_order.csv")
#Independent variables
#Born overseas data
write.csv(born_overseas_data, "born_overseas_data.csv")
#Indigenous data
write.csv(indigenous_data, "indigenous_data.csv")
#sole_parents_data
write.csv(sole_parents_data, "sole_parents_data.csv")
#Rental data
write.csv(rental_data, "rental_data.csv")
#Unemployment data
write.csv(unemployment_data, "unemployment_data.csv")
#Address
write.csv(address_data, "address_data.csv")
#Income
write.csv(income_data, "income_data.csv")



###*********************###
### Exploring the data ###
###********************###

##Exploring density distributions for each year for dependent variable of domestic violence
hist_1999 <- hist(dv_pop_order$yr1999pct, freq=FALSE, breaks=50, main="Density Plot Year 1999",
        xlab="Year 1999", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr1999pct), sd=sd(dv_pop_order$yr1999pct)),
        add=TRUE, col="darkblue", lwd=2)

hist_2000 <- hist(dv_pop_order$yr2000pct, freq=FALSE, breaks=50, main="Density Plot Year 2000",
                  xlab="Year 2000", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2000pct), sd=sd(dv_pop_order$yr2000pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2001 <- hist(dv_pop_order$yr2001pct, freq=FALSE, breaks=50, main="Density Plot Year 2001",
                  xlab="Year 2001", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2001pct), sd=sd(dv_pop_order$yr2001pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2002 <- hist(dv_pop_order$yr2002pct, freq=FALSE, breaks=50, main="Density Plot Year 2002",
                  xlab="Year 2002", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2002pct), sd=sd(dv_pop_order$yr2002pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2003 <- hist(dv_pop_order$yr2003pct, freq=FALSE, breaks=50, main="Density Plot Year 2003",
                  xlab="Year 2003", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2003pct), sd=sd(dv_pop_order$yr2003pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2004 <- hist(dv_pop_order$yr2004pct, freq=FALSE, breaks=50, main="Density Plot Year 2004",
                  xlab="Year 2004", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2004pct), sd=sd(dv_pop_order$yr2004pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2005 <- hist(dv_pop_order$yr2005pct, freq=FALSE, breaks=50, main="Density Plot Year 2005",
                  xlab="Year 2005", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2005pct), sd=sd(dv_pop_order$yr2005pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2006 <- hist(dv_pop_order$yr2006pct, freq=FALSE, breaks=50, main="Density Plot Year 2006",
                  xlab="Year 2006", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2006pct), sd=sd(dv_pop_order$yr2006pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2007 <- hist(dv_pop_order$yr2007pct, freq=FALSE, breaks=50, main="Density Plot Year 2007",
                  xlab="Year 2007", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2007pct), sd=sd(dv_pop_order$yr2007pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2008 <- hist(dv_pop_order$yr2008pct, freq=FALSE, breaks=50, main="Density Plot Year 2008",
                  xlab="Year 2008", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2008pct), sd=sd(dv_pop_order$yr2008pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2009 <- hist(dv_pop_order$yr2009pct, freq=FALSE, breaks=50, main="Density Plot Year 2009",
                  xlab="Year 2009", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2009pct), sd=sd(dv_pop_order$yr2009pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2010 <- hist(dv_pop_order$yr2010pct, freq=FALSE, breaks=50, main="Density Plot Year 2010",
                  xlab="Year 2010", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2010pct), sd=sd(dv_pop_order$yr2010pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2011 <- hist(dv_pop_order$yr2011pct, freq=FALSE, breaks=50, main="Density Plot Year 2011",
                  xlab="Year 2011", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2011pct), sd=sd(dv_pop_order$yr2011pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2012 <- hist(dv_pop_order$yr2012pct, freq=FALSE, breaks=50, main="Density Plot Year 2012",
                  xlab="Year 2012", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2012pct), sd=sd(dv_pop_order$yr2012pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2013 <- hist(dv_pop_order$yr2013pct, freq=FALSE, breaks=50, main="Density Plot Year 2013",
                  xlab="Year 2013", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2013pct), sd=sd(dv_pop_order$yr2013pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2014 <- hist(dv_pop_order$yr2014pct, freq=FALSE, breaks=50, main="Density Plot Year 2014",
                  xlab="Year 2014", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2014pct), sd=sd(dv_pop_order$yr2014pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2015 <- hist(dv_pop_order$yr2015pct, freq=FALSE, breaks=50, main="Density Plot Year 2015",
                  xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2015pct), sd=sd(dv_pop_order$yr2015pct)),
      add=TRUE, col="darkblue", lwd=2)

hist_2016 <- hist(dv_pop_order$yr2016pct, freq=FALSE, breaks=50, main="Density Plot Year 2016",
                  xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(dv_pop_order$yr2016pct), sd=sd(dv_pop_order$yr2016pct)),
      add=TRUE, col="darkblue", lwd=2)

# Check the average percentage of domestic violence offences as a percentage of the
#population over time
names(dv_pop_order)
dv_pop_order_ppt <- dv_pop_order[,c(1:2, 39:56)]
dv_pop_mean <- colMeans(dv_pop_order_ppt[sapply(dv_pop_order_ppt, is.numeric)])*100
#Find median of average domestic violence as a percentage of the population
median_average <- median(dv_pop_mean)
```

## A research study on the predictors of domestic violence in NSW

---

######**Aim:**
The aim of this study was to explore the relationship between a number of economic, financial stress and family status predictors, including male unemployment, weekly income, sole parent households and its impact on domestic violence incidents in NSW.

######**Method:**
The study used data from the Australian Census provided by the Australian Bureau of Statistics for the years 2006, 2011 and 2016. A generalised linear Poisson model was used to study the relationship male unemployment, weekly income, sole parent households and its impact on domestic violence incidents in NSW Local Government Areas (LGA's).


######**Results:**
The risk of domestic violence was significantly higher for those areas where the male was unemployed, the victim is a sole parent and weekly personal income is between $800 and $1249. The results reveal a 69.7%  (exp{0.52888} = 1.697) increased risk of domestic violence incidents per 1000 people in NSW compared to those people not exposed to these factors.

######**Conclusion:**
Economic situation, financial stress and family status predictors are strongly correlated variables for the incidents of domestic violence in NSW Local Government Areas. Further research however would be necessary to better understand if these factors are causal or there are other confounding factors at play as a result of domestic violence events.


### Introduction
Domestic violence is a major concern for Australia's local and state authorities and under the Australian Government's National Plan to Reduce Violence against Women and their Children 2010-2022, it defines domestic violence as acts of violence that occur between people who have or have had, an intimate relationship (Dunkley and Phillips, 2015, pp.1). This is further defined by The Health Costs of Violence report (2003, pp.5) as any form of intimate partner violence that can occur on a continuum of economic, psychological and emotional abuse, through physical and sexual violence. As demonstrated in the chart below levels of domestic violence in NSW have increased in frqeuncy from 2006 to 2016:

```{r ,echo=FALSE}
par(mfrow = c(1,1))
plot(dv_pop_mean, type="b", main="Median Average Percentage of NSW \n Population Experiencing Domestic Violence",
     lwd=2, col="darkblue", xlab="Count of Years: 1999 to 2016", ylab="Average Percentage",
     xlim=c(0,19), ylim=c(0,0.55))
grid(NULL,NULL, lty = 6, col = "gray")
abline(h = median_average, col="orange", lwd=2, lty=2)
text(2, 0.53, "Median \n Average \n 0.48%", col = "orange", cex=0.8, font=2)
```



Cox (2015) cites a number of risk factors with women aged 25-34 years experiencing the highest rate of male intimate domestic violence of all age groups. Furthermore, women from non-English speaking countries experienced domestic violence at double the rates compared to those from English speaking countries. Stavrou et al. (2016) cite sole parents, financial stress and those with a disability or long-term health condition as also being at risk. The latest Domestic Violence Statistics for NSW report (2013-2017) indicates alcohol was involved in almost one-third of all domestic violence incidents, while the male unemployment rate and the level of residential instability are also cited as key risk factors (People, 2005).


###Data and Methodology
The study sourced data on male unemployment, weekly income and sole parents from the Australian Census provided by the Australian Bureau of Statistics for the years 2006, 2011 and 2016. Data from Census 2001 was not available from the ABS Census TableBuilder and has therefore been excluded from this study[1]. The assumption made to compile data for the years in-between Census was populated as a percentage of the moving average growth rate from one Census date to the next. Due to the fact 2001 Census data was not available, domestic violence incidents were analysed from 2006 through to 2016. The additional year of domestic violence data was sourced from the NSW Bureau of Crime Statistics and Research (BOSCAR). Additional data from BOSCAR, in particular alcohol related domestic violence incidents, was unavailable for the required time frame and was therefore not included in the study. Estimated resident population count data was obtained from the Australian Bureau of Statistics for each year of analysis.

One issue which arose when analysing Census data from 2006 to 2016 was the change in council regions in 2016 where a number of different councils were amalgamated. To counter this, all historical data prior to 2016 was matched to the new LGA regions so the results are relevant and reproducible in the future. Refer to Appendix.

This research study and other research studies which rely on Census data are however limited by the ability to effectively understand economic and financial stress indicators, such as employment status and weekly income, making the general assumption those on lower incomes and those who are unemployed experience more financial stress than those on higher incomes or with jobs (Weatherburn, 2011). Weatherburn (2011) claims "this may be true as a rough generalisation but the level of financial stress experienced by an individual depends not just on their income but also on their financial commitments and liabilities... and is best measured in terms reflective of the gap between income and expenditure."


Considering the type of count data available and its inherent distribution characteristics a generalised linear Poisson model with a link log was the first model considered. The Poisson model was considered due to the relationship between the mean and the variance and the nature of count data where the variance typically increases with the mean (Christensen, 1997). The disadvantage of a glm Poisson model is that while the linear predictor can represent any real world value, the Poisson mean, which represents a count, has to be non-negative. Given this a simple solution is to log transform the mean and assume the transformed mean follows a linear pattern. As cited by Lillis (2015) one further drawback to this model, which was experienced in this study, is that it can suffer from over-dispersion which occurs when the variance is larger than the mean in our dependent variable, or in other words, the residual variance is larger than the conditional mean. Lillis recommends the application of a Quasi-Poisson model fitting an extra dispersion parameter to account for the extra variance and confirming the over-dispersion.

In an attempt to address this over-dispersion a Negative Binomial Regression model has been applied, which unlike the Poisson model, assumes the mean and the variance are not equal. As explained by Kleiber et al.(2016) "as the dispersion parameter gets larger and larger, the variance converges to the same value as the mean, and the negative binomial turns into a Poisson distribution".

Finally, to improve the validity of the data to be integrated into the model any NSW LGA regions which had domestic violence counts outside of the interquartile range were excluded from the analysis and considered outliers. A total of 45 LGA regions and their data were included in the analysis.

```{r, include=FALSE}
#Exploring density distributions for independent variables
#Born Australia/ Overseas
#Males born Australia
hist_male_birth_au_ppt <- hist(born_overseas_data$male_birth_au_ppt, freq=FALSE,
                                     breaks=50, main="Density Plot Males Born Australia",
                                     xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(born_overseas_data$male_birth_au_ppt),
            sd=sd(born_overseas_data$male_birth_au_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Females born Australia
hist_female_birth_au_ppt <- hist(born_overseas_data$female_birth_au_ppt, freq=FALSE,
                               breaks=50, main="Density Plot Females Born Australia",
                               xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(born_overseas_data$female_birth_au_ppt),
            sd=sd(born_overseas_data$female_birth_au_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Males born Overseas
hist_male_birth_os_ppt <- hist(born_overseas_data$male_birth_os_ppt, freq=FALSE,
                               breaks=50, main="Density Plot Males Born Overseas",
                               xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(born_overseas_data$male_birth_os_ppt),
            sd=sd(born_overseas_data$male_birth_os_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Females born Overseas
hist_female_birth_os_ppt <- hist(born_overseas_data$female_birth_os_ppt, freq=FALSE,
                               breaks=50, main="Density Plot Females Born Overseas",
                               xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(born_overseas_data$female_birth_os_ppt),
            sd=sd(born_overseas_data$female_birth_os_ppt)),
      add=TRUE, col="darkblue", lwd=2)

##Indigenous/ Non-Indigenous Population
#Indigenous Males
hist_Total_Indig_Males_ppt <- hist(indigenous_data$Total_Indig_Males_ppt, freq=FALSE,
                                 breaks=50, main="Density Plot Indigenous Males",
                                 xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(indigenous_data$Total_Indig_Males_ppt),
            sd=sd(indigenous_data$Total_Indig_Males_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Indigenous Females
hist_Total_Indig_Females_ppt <- hist(indigenous_data$Total_Indig_Females_ppt, freq=FALSE,
                                   breaks=50, main="Density Plot Indigenous Females",
                                   xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(indigenous_data$Total_Indig_Females_ppt),
            sd=sd(indigenous_data$Total_Indig_Females_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Non-Indigenous Males
hist_Total_Non_Indig_Males_ppt <- hist(indigenous_data$Total_Non_Indig_Males_ppt, freq=FALSE,
                                   breaks=50, main="Density Plot Non-Indigenous Males",
                                   xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(indigenous_data$Total_Non_Indig_Males_ppt),
            sd=sd(indigenous_data$Total_Non_Indig_Males_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Non-Indigenous Females
hist_Total_Non_Indig_Females_ppt <- hist(indigenous_data$Total_Non_Indig_Females_ppt, freq=FALSE,
                                       breaks=50, main="Density Plot Non-Indigenous Females",
                                       xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(indigenous_data$Total_Non_Indig_Females_ppt),
            sd=sd(indigenous_data$Total_Non_Indig_Females_ppt)),
      add=TRUE, col="darkblue", lwd=2)


##Family and Sole Parent Families
#Couple/ Family with No Children
hist_Coup_Fam_No_Child_ppt <- hist(sole_parents_data$Coup_Fam_No_Child_ppt, freq=FALSE,
                                   breaks=50, main="Density Plot Couple/Family \n with No Children",
                                   xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(sole_parents_data$Coup_Fam_No_Child_ppt),
            sd=sd(sole_parents_data$Coup_Fam_No_Child_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Couple/ Family with Children
hist_Coup_Fam_W_Child_ppt <- hist(sole_parents_data$Coup_Fam_W_Child_ppt, freq=FALSE,
                                   breaks=50, main="Density Plot Couple/Family \n with Children",
                                   xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(sole_parents_data$Coup_Fam_W_Child_ppt),
            sd=sd(sole_parents_data$Coup_Fam_W_Child_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#One Parent Family
hist_Sole_Parent_ppt <- hist(sole_parents_data$Sole_Parent_ppt, freq=FALSE,
                                  breaks=50, main="Density Plot Sole Parent Family",
                                  xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(sole_parents_data$Sole_Parent_ppt),
            sd=sd(sole_parents_data$Sole_Parent_ppt)),
      add=TRUE, col="darkblue", lwd=2)


##Rental accommodation
#Government rental
hist_Government_ppt <- hist(rental_data$Government_ppt, freq=FALSE,
                                         breaks=50, main="Density Plot Government Rental",
                                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(rental_data$Government_ppt),
            sd=sd(rental_data$Government_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Private rental
hist_Private_ppt <- hist(rental_data$Private_ppt, freq=FALSE,
                             breaks=50, main="Density Plot Private Rental",
                             xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(rental_data$Private_ppt),
            sd=sd(rental_data$Private_ppt)),
      add=TRUE, col="darkblue", lwd=2)


##Unemployment data
hist_unemp_male_ppt <- hist(unemployment_data$Unemployment_Male_ppt, freq=FALSE,
                         breaks=50, main="Density Plot Unemployment Males",
                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(unemployment_data$Unemployment_Male_ppt),
            sd=sd(unemployment_data$Unemployment_Male_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_unemp_female_ppt <- hist(unemployment_data$Unemployment_Female_ppt, freq=FALSE,
                            breaks=50, main="Density Plot Unemployment Females",
                            xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(unemployment_data$Unemployment_Female_ppt),
            sd=sd(unemployment_data$Unemployment_Female_ppt)),
      add=TRUE, col="darkblue", lwd=2)


#Address data
hist_same_add_males_ppt <- hist(address_data$same_add_males_ppt, freq=FALSE,
                              breaks=50, main="Density Plot Same Address Males",
                              xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(address_data$same_add_males_ppt),
            sd=sd(address_data$same_add_males_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_same_add_females_ppt <- hist(address_data$same_add_females_ppt, freq=FALSE,
                                breaks=50, main="Density Plot Same Address Females",
                                xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(address_data$same_add_females_ppt),
            sd=sd(address_data$same_add_females_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_diff_add_males_ppt <- hist(address_data$diff_add_males_ppt, freq=FALSE,
                                  breaks=50, main="Density Plot Different Address Males",
                                  xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(address_data$diff_add_males_ppt),
            sd=sd(address_data$diff_add_males_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_diff_add_females_ppt <- hist(address_data$diff_add_females_ppt, freq=FALSE,
                                breaks=50, main="Density Plot Different Address Females",
                                xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(address_data$diff_add_females_ppt),
            sd=sd(address_data$diff_add_females_ppt)),
      add=TRUE, col="darkblue", lwd=2)


##Income data
hist_Nil_Income_ppt <- hist(income_data$Nil_Income_ppt, freq=FALSE,
                                breaks=50, main="Density Plot Nil Income",
                                xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$Nil_Income_ppt),
            sd=sd(income_data$Nil_Income_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x100_199_ppt <- hist(income_data$x100_199_ppt, freq=FALSE,
                            breaks=50, main="Density Plot $100-$199",
                            xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x100_199_ppt),
            sd=sd(income_data$x100_199_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x200_299_ppt <- hist(income_data$x200_299_ppt, freq=FALSE,
                            breaks=50, main="Density Plot $200-$299",
                            xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x200_299_ppt),
            sd=sd(income_data$x200_299_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x300_399_ppt <- hist(income_data$x300_399_ppt, freq=FALSE,
                            breaks=50, main="Density Plot $300-$399",
                            xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x300_399_ppt),
            sd=sd(income_data$x300_399_ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x400_599ppt <- hist(income_data$x400_599ppt, freq=FALSE,
                            breaks=50, main="Density Plot $400-$599",
                            xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x400_599ppt),
            sd=sd(income_data$x400_599ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x600_799ppt <- hist(income_data$x600_799ppt, freq=FALSE,
                         breaks=50, main="Density Plot $600-$799",
                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x600_799ppt),
            sd=sd(income_data$x600_799ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x800_999ppt <- hist(income_data$x800_999ppt, freq=FALSE,
                         breaks=50, main="Density Plot $800-$999",
                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x800_999ppt),
            sd=sd(income_data$x800_999ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x1000_1249ppt <- hist(income_data$x1000_1249ppt, freq=FALSE,
                         breaks=50, main="Density Plot $1000-$1249",
                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x1000_1249ppt),
            sd=sd(income_data$x1000_1249ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x1250_1499ppt <- hist(income_data$x1250_1499ppt, freq=FALSE,
                           breaks=50, main="Density Plot $1250-$1499",
                           xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x1250_1499ppt),
            sd=sd(income_data$x1250_1499ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x1500_1999ppt <- hist(income_data$x1500_1999ppt, freq=FALSE,
                           breaks=50, main="Density Plot $1500-$1999",
                           xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x1500_1999ppt),
            sd=sd(income_data$x1500_1999ppt)),
      add=TRUE, col="darkblue", lwd=2)

hist_x2000_plusppt <- hist(income_data$x2000_plusppt, freq=FALSE,
                           breaks=50, main="Density Plot $2000_plus",
                           xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(income_data$x2000_plusppt),
            sd=sd(income_data$x2000_plusppt)),
      add=TRUE, col="darkblue", lwd=2)
```


###Results and Implications
######**Understanding the distribution of the independent | predictor variables**
After consulting numerous literacy studies as mentioned earlier in the report, a number of independent or predictor variables were considered as having a potential relationship to the dependent or outcome variable of domestic violence incidents in NSW local government areas. The first step to understanding the data was to plot the distribution of the data to understand its typical spread. Some examples of this are provided below where we can see a typical poisson type of distribution:

```{r, echo=FALSE}
par(mfrow = c(2,2))
#Unemployment data
hist_unemp_male_ppt <- hist(unemployment_data$Unemployment_Male_ppt, freq=FALSE,
                         breaks=50, main="Density Plot Unemployment Males",
                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(unemployment_data$Unemployment_Male_ppt),
            sd=sd(unemployment_data$Unemployment_Male_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Indigenous Males
hist_Total_Indig_Males_ppt <- hist(indigenous_data$Total_Indig_Males_ppt, freq=FALSE,
                                 breaks=50, main="Density Plot Indigenous Males",
                                 xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(indigenous_data$Total_Indig_Males_ppt),
            sd=sd(indigenous_data$Total_Indig_Males_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Males born Overseas
hist_male_birth_os_ppt <- hist(born_overseas_data$male_birth_os_ppt, freq=FALSE,
                               breaks=50, main="Density Plot Males Born Overseas",
                               xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(born_overseas_data$male_birth_os_ppt),
            sd=sd(born_overseas_data$male_birth_os_ppt)),
      add=TRUE, col="darkblue", lwd=2)

#Government rental
hist_Government_ppt <- hist(rental_data$Government_ppt, freq=FALSE,
                                         breaks=50, main="Density Plot Government Rental",
                                         xlab="% of Population", col="lightgreen")
curve(dnorm(x, mean=mean(rental_data$Government_ppt),
            sd=sd(rental_data$Government_ppt)),
      add=TRUE, col="darkblue", lwd=2)

```


```{r, echo=FALSE}
##Now that we have wrangled and transformed our data we can now look at the association
#between the dependent and independent variables of interest
dv_pop_order_corr <- dv_pop_order[,c(1:2,10)] #2006 Census
address_data_corr <- address_data[,c(1,10)]
young_women_data_corr <- young_women_data
unemployment_data_corr <- unemployment_data[,c(1,5)]
indigenous_data_corr <- indigenous_data[,c(1,8,10)] #Males and Females very highly correlated. Only Males choosen.
born_overseas_data_corr <- born_overseas_data[,c(1,10,12)]
sole_parents_data_corr <- sole_parents_data[,c(1,7:9)]
rental_data_corr <- rental_data[,c(1,7)]
income_data_corr <- income_data[,c(1,29)]

#young_women_data_corr <- young_women_data[,c(1,89,101)] #Very high correlation to All Indigenous Males so excluded.
#names(address_data)
all_data <- join(dv_pop_order_corr, address_data_corr, by='region_id', type="inner")
all_data <- join(all_data, unemployment_data_corr, by='region_id', type="inner")
all_data <- join(all_data, indigenous_data_corr, by='region_id', type="inner")
all_data <- join(all_data, born_overseas_data_corr, by='region_id', type="inner")
all_data <- join(all_data, sole_parents_data_corr, by='region_id', type="inner")
all_data <- join(all_data, rental_data_corr, by='region_id', type="inner")
all_data <- join(all_data, income_data_corr, by='region_id', type="inner")
all_data_cor <- cor(all_data[,c(3:14)])
```


######**Understanding correlation domestic violence and independent variables**
With our independent | predictor variables combined into the one dataframe the next step was to identify any possible correlation to domestic violence as well as any potential multicollinearity which may exist. Due to the possiblity of these factors changing over the time period of the domestic violence data (from 2006 to 2016) this was taken at a point in time in both years to see if there was evidence of any significant change. The two correlation matricies are shown below:

```{r, echo = FALSE}
par(mfrow=c(1,1))
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(all_data_cor, method="color", col=col(200),  
         type="upper", #order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", #tl.srt=45, #Text label color and rotation
         # Combine with significance
         #p.mat = p.mat, sig.level = 0.01, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         title = "Correlation Matrix: Domestic Violence 2006",
         mar=c(0,0,1,0),
         tl.cex = 0.7,
         number.cex=0.75,
         diag=FALSE
)
```


```{r, echo=FALSE}
##Now that we have wrangled and transformed our data we can now look at the association
#between the dependent and independent variables of interest
dv_pop_order_corr <- dv_pop_order[,c(1:2,20)] #2006 Census
address_data_corr <- address_data[,c(1,10)]
young_women_data_corr <- young_women_data
unemployment_data_corr <- unemployment_data[,c(1,5)]
indigenous_data_corr <- indigenous_data[,c(1,8,10)] #Males and Females very highly correlated. Only Males choosen.
born_overseas_data_corr <- born_overseas_data[,c(1,10,12)]
sole_parents_data_corr <- sole_parents_data[,c(1,7:9)]
rental_data_corr <- rental_data[,c(1,7)]
income_data_corr <- income_data[,c(1,29)]

#young_women_data_corr <- young_women_data[,c(1,89,101)] #Very high correlation to All Indigenous Males so excluded.
#names(address_data)
all_data <- join(dv_pop_order_corr, address_data_corr, by='region_id', type="inner")
all_data <- join(all_data, unemployment_data_corr, by='region_id', type="inner")
all_data <- join(all_data, indigenous_data_corr, by='region_id', type="inner")
all_data <- join(all_data, born_overseas_data_corr, by='region_id', type="inner")
all_data <- join(all_data, sole_parents_data_corr, by='region_id', type="inner")
all_data <- join(all_data, rental_data_corr, by='region_id', type="inner")
all_data <- join(all_data, income_data_corr, by='region_id', type="inner")
all_data_cor <- cor(all_data[,c(3:14)])
```


```{r, echo = FALSE}
par(mfrow=c(1,1))
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(all_data_cor, method="color", col=col(200),  
         type="upper", #order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", #tl.srt=45, #Text label color and rotation
         # Combine with significance
         #p.mat = p.mat, sig.level = 0.01, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         title = "Correlation Matrix: Domestic Violence 2016",
         mar=c(0,0,1,0),
         tl.cex = 0.7,
         number.cex=0.75,
         diag=FALSE
)
```


Those people earning a weekly income of between $800 and $1249 is the only factor which continued to show the highest level of correlation in both Census years (0.43). Those on Nil-to-low and higher incomes were found to show no positive correlation. Sole parents had the second highest level of correlation although this did drop from 0.38 in 2006 to 0.17 in 2016. Couples with children and Indigenous males were the only other two variables to show some movement, although minimal. Thus the key predictors brought into the model are Male Unemployment, Weekly Income between $800-$1249 and Sole Parents. Indigenous Males were not brought into the model due to the higher level of correlation to Male Unemployment (0.25).


######**Assessing model fit and residual deviance**
A 70% training set was established and randomly shuffled to ensure randomness in the selection of the data. The training data set will also allow us to train our final model against a a final testing set of data following a 10 k-fold cross-validation to ensure our model does not over-fit the data. Using the training set data a Poisson model was created for each predictor variable in order to gain a better understanding of the effect of each predictor on the outcome variable. The output below demonstrates the effect of each of these predictor variables on domestic violence incidents with no relationship to Male Unemployment and a positive relationship to Weekly Income and Sole Parents.


```{r, echo=FALSE}
#Now that we know some of the key correlations, it is time to bring in other Census data from 2006 and 2016
#In order to calculate the values between Census years the average growth rate was taken between the Census
#years and projected over the four years between
#Read in the complete Census data 2006 to 2016
unemployment_data_complete <- read.csv("2006_16_Employment.csv", header=TRUE)
income_data_complete <- read.csv("2006_16_Income.csv", header=TRUE)
family_data_complete <- read.csv("2006_16_Family.csv", header=TRUE)

all_model_data <- dv_pop_order[,c(1:38)]
model_data <- join(all_model_data, unemployment_data_complete, by="region_id", type="inner")
model_data <- join(model_data, income_data_complete, by="region_id", type="inner")
model_data <- join(model_data, family_data_complete, by="region_id", type="inner")
model_data <- model_data[,-c(39,51,63)]


#Domestic Violence
colnames(dv_pop_order)[29] <- "yr2007_pop"
model_data_dv <- melt(model_data[,c(1:2, 10:20)])
colnames(model_data_dv)[3] <- "Domestic_Violence"
colnames(model_data_dv)[4] <- "Domestic_Violence_Count"

#LGA Popuation
model_data_pop <- melt(dv_pop_order[,c(1:2,28:38)])
colnames(model_data_pop)[3] <- "Population"
colnames(model_data_pop)[4] <- "Population_Count"

#Males Unemployment
model_data_unemployment <- melt(model_data[,c(1:2,39:49)])
colnames(model_data_unemployment)[3] <- "M_Unemployment"
colnames(model_data_unemployment)[4] <- "M_Unemployment_ppt"

#Income
model_data_income <- melt(model_data[,c(1:2,50:60)])
colnames(model_data_income)[3] <- "Income_x800_1249"
colnames(model_data_income)[4] <- "Income_x800_1249_ppt"

#Sole Parents
model_data_family_sole_par <- melt(model_data[,c(1:2, 72:82)])
colnames(model_data_family_sole_par)[3] <- "Sole_parent"
colnames(model_data_family_sole_par)[4] <- "Sole_parent_ppt"


model_data_final <- cbind(model_data_dv
                        ,model_data_pop
                        ,model_data_unemployment
                        ,model_data_income
                        ,model_data_family_sole_par
                        )
#Remove variables not needed for model data
model_data_final <- model_data_final[,-c(3,5,6,7,9,10,11,13,14,15,17,18,19)]


#Build Poisson model
#STEP ONE: Create training and testing data partitions based on random shuffle
#70% of the sample size
sample_split <- floor(0.70 * nrow(model_data_final))

## set the seed to make your partition reproducible and create the training and testing split
set.seed(123)
train_ind <- sample(seq_len(nrow(model_data_final)), size = sample_split)
dataTrain <- model_data_final[train_ind, ]
dataTest <- model_data_final[-train_ind, ]

#STEP TWO: Fit the model
#First we will create a plot for each predictor.
#This can be very helpful for helping us understand the effect of each predictor on the outcome variable.
par(mfrow =c(2,2))

#Male Unemployment
glm.fit_M_Unemployment <- glm(Domestic_Violence_Count~
                      M_Unemployment_ppt
                      #+ offset(log(Population_Count))
                      , family=poisson(link=log)
                      , data = dataTrain
)
#summary(glm.fit_M_Unemployment)

#Now we create our plots. First we set up a sequence of length values which we will use to plot the fitted model. Let's find the range of each variable.
#range(dataTrain$M_Unemployment_ppt)

xM_M_Unemployment_ppt <-seq (0, 0.2, 0.001)
yM_M_Unemployment_ppt <- predict(glm.fit_M_Unemployment,
                                   list(M_Unemployment_ppt=xM_M_Unemployment_ppt),type="response")

plot(dataTrain$M_Unemployment_ppt, dataTrain$Domestic_Violence_Count, pch = 16, xlab = "Males Unemployment (x100 for percentage)", ylab = "Domestic Violence Incidents")
lines(xM_M_Unemployment_ppt, yM_M_Unemployment_ppt, col = "red", lwd = 2)


#Income
glm.fit_Income <- glm(Domestic_Violence_Count~
                              Income_x800_1249_ppt
                              #+ offset(log(Population_Count))
                              , family=poisson(link=log)
                              , data = dataTrain
)
#summary(glm.fit_Income)

#Now we create our plots. First we set up a sequence of length values which we will use to plot the fitted model. Let's find the range of each variable.
#range(dataTrain$Income_x800_1249_ppt)

xM_Income_x800_1249_ppt <-seq (0, 0.3, 0.001)
yM_Income_x800_1249_ppt <- predict(glm.fit_Income,
                               list(Income_x800_1249_ppt=xM_Income_x800_1249_ppt),type="response")

plot(dataTrain$Income_x800_1249_ppt, dataTrain$Domestic_Violence_Count, pch = 16, xlab = "Weekly Income $800-$1249 (x100 for percentage)", ylab = "Domestic Violence Incidents")
lines(xM_Income_x800_1249_ppt, yM_Income_x800_1249_ppt, col = "red", lwd = 2)


#Sole Parents
glm.fit_Sole_parent <- glm(Domestic_Violence_Count~
                              Sole_parent_ppt
                              #+ offset(log(Population_Count))
                              , family=poisson(link=log)
                              , data = dataTrain
)
#summary(glm.fit_Sole_parent)

#Now we create our plots. First we set up a sequence of length values which we will use to plot the fitted model. Let's find the range of each variable.
#range(dataTrain$Sole_parent_ppt)

xSole_parent_ppt <-seq (0, 0.4, 0.01)
ySole_parent_ppt <- predict(glm.fit_Sole_parent,
                               list(Sole_parent_ppt=xSole_parent_ppt),type="response")

plot(dataTrain$Sole_parent_ppt, dataTrain$Domestic_Violence_Count, pch = 16, xlab = "Sole Parents (x100 for percentage)", ylab = "Domestic Violence Incidents")
lines(xSole_parent_ppt, ySole_parent_ppt, col = "red", lwd = 2)
```


After analysing each of the predictor variables and the impact on domestic violence, all of the predictor variables are combined into the Poisson model. While each predictor variable is represented as a percentage of the population for each LGA a population count has been implemented as the offset on a per 1,000 person basis.

```{r, echo=FALSE}
#Fit Poisson model
glm.fit.Poisson <- glm(Domestic_Violence_Count~
               + M_Unemployment_ppt
               + Income_x800_1249_ppt
               + Sole_parent_ppt
               + offset(log(Population_Count/1000))
               , family=poisson(link=log)
               , data = dataTrain
)

#Analyse model summary variables
summary(glm.fit.Poisson)
pR2(glm.fit.Poisson)
```

The output demonstrates for each additional male who is unemployed in NSW per 1000 people there is a 5.99 log count increase in domestic violence incidents, a 0.64 log count increase in domestic violence incidents for people with a weekly income between $800 and $1249 and a 2.31 log count increase in domestic violence incidents for sole parents. While not an exact equivalent to the R2 of linear regression exists, the McFadden R2 index can be used to assess the model fit and at 0.16 it doesn't appear to be a good fit. There also appears to be possible over-dipsersion based on the deviance and degrees of freedom while the addional plots below indicate there are problems with normality and potentially heterogeneity in the Poisson model.

```{r, echo=FALSE}
par(mfrow = c(2,2))
plot(glm.fit.Poisson)
```


To better understand the potential over-dispersion a Quasi-Poisson model was analysed below:


```{r, echo=FALSE}
#Fit Quasi-Poisson model
glm.fit.Quasi <- glm(Domestic_Violence_Count~
                  + M_Unemployment_ppt
                  + Income_x800_1249_ppt
                  + Sole_parent_ppt
                  + offset(log(Population_Count/1000))
                  , family=quasipoisson(link=log)           
                  , data = dataTrain
)

#Analyse model summary variables
summary(glm.fit.Quasi)
par(mfrow = c(2,2))
plot(glm.fit.Quasi)
```


The dispersion parameter (deviance divided by the residual degrees of freedom) was 30.7, which is much greater than 1, indicating over-dispersion. In an attempt to deal with this phenomena a negative binomial distribution model was selected, but unlike the Poisson distribution, the variance and the mean are not equivalent indicating it may better represent modeling counts with variability that is different from the mean.

```{r, echo=FALSE}
#Due to over-dispersion fit the Negative Binomial Distribution model
glm.fit.nb <- glm.nb(Domestic_Violence_Count~
               + M_Unemployment_ppt
               + Income_x800_1249_ppt
               + Sole_parent_ppt
               + offset(log(Population_Count/1000))
               , data = dataTrain
)

#Analyse model summary variables
summary(glm.fit.nb)
```


The output indicates Male Unemployment has a co-efficient of 6.2625, Weekly Income of $800-$1249 of 1.2128 and Sole Parents of 1.2230, which are all statistically significant. This means that for each one count increase in Male Unemployment, Weekly Income and Sole Parents per 1,000 people in NSW LGA's, the expected log count of the number of domestic violence incidents increases by 6.2625, 1.2128 and 1.2230, respectively. The Negative Binomial Distribution model has also addressed the over-dispersion issue with much closer deviance and degrees of freedom indicators.

```{r, echo=FALSE}
par(mfrow = c(2,2))
plot(glm.fit.nb)
```


The below charts also demonstrate the Negative Binomial Distribution residuals for each of the predictor variables:

```{r, echo=FALSE}
#Residuals Plot
#Male Unemployment
layout(matrix(c(1,1,2,3),2,2,byrow=T))
plot(glm.fit.nb$resid ~ dataTrain$M_Unemployment_ppt,
     main="Residuals\nfor Negative Binomial Regression",
     xlab="Males Unemployment", ylab="Residuals")
abline(h=0,lty=2,col="red")
#Histogram of Residuals
hist(glm.fit.nb$resid, main="Histogram of Residuals", ylab="Residuals")
abline(v=0,lty=2,col="red")
#Q-Q Plot
qqnorm(glm.fit.nb$resid)
qqline(glm.fit.nb$resid, col="red")


#Income
layout(matrix(c(1,1,2,3),2,2,byrow=T))
plot(glm.fit.nb$resid ~ dataTrain$Income_x800_1249_ppt,
     main="Residuals\nfor Negative Binomial Regression",
     xlab="Weekly Income $800-$1249", ylab="Residuals")
abline(h=0,lty=2,col="red")
#Histogram of Residuals
hist(glm.fit.nb$resid, main="Histogram of Residuals", ylab="Residuals")
abline(v=0,lty=2,col="red")
#Q-Q Plot
qqnorm(glm.fit.nb$resid)
qqline(glm.fit.nb$resid, col="red")


#Single Parent Families
layout(matrix(c(1,1,2,3),2,2,byrow=T))
plot(glm.fit.nb$resid ~ dataTrain$Sole_parent_ppt,
     main="Residuals\nfor Negative Binomial Regression",
     xlab="Single Parent Families", ylab="Residuals")
abline(h=0,lty=2,col="red")
#Histogram of Residuals
hist(glm.fit.nb$resid, main="Histogram of Residuals", ylab="Residuals")
abline(v=0,lty=2,col="red")
#Q-Q Plot
qqnorm(glm.fit.nb$resid)
qqline(glm.fit.nb$resid, col="red")
```


######**Assessing the predictive ability of the model**
A 10k fold cross-validation was performed on the training set to avoid over-fitting the model on the final testing data set. A sample of the predicted domestic violence count rates versus the actual count rates are shown below. Over the testing data set the prediction accuracy of the model has a median difference of 12.9%.

```{r, echo=FALSE}
fitted.results <- predict(glm.fit.nb, newdata = dataTest, type='response')

#Checking the mean of the fitted results versus the actual
fitted_mean <- mean(fitted.results)
actual_mean <- mean(model_data_final[,3])
#fitted_mean - actual_mean

##Cross-validation check of the model
fold <- createFolds(dataTrain$Domestic_Violence_Count, k=10)

preds <- vector(mode = "list")
for(i in 1:length(fold)){
preds <- predict(glm.fit.nb, train=dataTrain[-fold[[i]], c(5:8)], test=dataTest[fold[[i]], c(5:8)],
                cl=model_data_final$region_id[-fold[[i]]], type='response')
}

#Convert predictions to a dataframe
preds <- as.data.frame(preds)

#Prediction
output = data.frame(dataTrain, pred=round(glm.fit.nb$fitted))
colnames(output)[8] <- "Prediction"
output$Difference <- round(output$Prediction-output$Domestic_Violence_Count)
output <- output[,c(1,3,8:9)]
output[c(230:239),]
round(median(output$Difference/output$Domestic_Violence_Count)*100, digits=1)
```


Finally, a plot of the actual and predicted domestic violence counts on the testing data set is shown on the scatter plot below indicating a positive relationship.

```{r, echo=FALSE}
#Plot Actual versus Predicted
par(mfrow = c(1,1))
newdata = dataTest
ggplot(data = output, aes(x=Domestic_Violence_Count, y=Prediction)) +
        geom_point(alpha=0.2, colour="darkblue", size=2.5) +
        stat_smooth(method = "lm", col = "red") +
        labs(x="Actual Domestic Violence Incidents",
             y="Predicted Domestic Violence Incidents") +
        labs(title = "Actual vs Predicted Domestic Violence Incidents") +
        theme(plot.title = element_text(hjust = 0.5, vjust = 3))
        #labs(caption = "(Based on Census Data 2006, 2011 and 2016)")
```


###Conclusion


###References
Census Table Builder, https://auth.censusdata.abs.gov.au/webapi/jsf/dataCatalogueExplorer.xhtml

Christensen,R. 1997, Log-Linear Models and Logistic Regression, Chapter 9, Springer-Verlag New York.
Dunkley, A and Phillips, J. 2015, Domestic Violence in Australia: A quick guide to the issues, Parliament of Australia, Department of Parliamentary Services.

Kleiber, Christian & Zeileis, Achim (2016), Visualizing Count Data Regressions Using Rootograms, The American Statistician.

Lillis, D. (2015), Generalized Linear Models in R, Part 7: Checking for Overdispersion in Count Regression, available: https://www.theanalysisfactor.com/glm-r-overdispersion-count-regression.

People, Julie. 2015, Trends and Patterns in Domestic Violence Assaults, NSW Bureau of Crime Statistics and Research, Number 89.

Stavrou, E, Poynton, S & Weatherburn, S. November 2016, Intimate partner violence against women in Australia: related factors and help-seeking behaviours, NSW Bureau of Crime Statistics and Research.

Weatherburn, D (2011), Personal Stress, financial stress and violence against women, Contemporary Issues in Crime and Justice, NSW Bureau of Crime Statistics and Research, Number 151.


###Appendix
Canterbury-Bankstown (A)
The Canterbury-Bankstown Council is a local government area located in the south-western suburbs of Sydney, in New South Wales, Australia. The council was formed on 12 May 2016 from a merger of the City of Canterbury and the City of Bankstown,[2] after a review of local government in New South Wales by the state government.
Source: Canterbury-Bankstown Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 14 May 2016.

Snowy Monaro Regional (A)
The Snowy Monaro Regional Council is a local government area located in the Snowy Mountains and Monaro regions of New South Wales, Australia. The council was formed on 12 May 2016 through a merger of the Bombala, Cooma-Monaro and Snowy River shires.[1]
Source: Snowy Monaro Regional Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Hilltops (A)
Hilltops Council is a local government area in the South West Slopes region of New South Wales, Australia. This area was formed on the 12 May 2016 from the merger of Boorowa Council, Harden Shire and Young Shire.[2]
Source: Hilltops Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 14 May 2016.

Central Coast (C) (NSW)
The Central Coast Council is a local government area serving the Central Coast region of New South Wales, Australia, established on 12 May 2016 following the amalgamation of Gosford City and Wyong Shire councils.
Source: Central Coast Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 14 May 2016.

Edward River (A)
The Edward River Council is a local government area in the Riverina region of New South Wales, Australia. This area was formed in 2016 from the merger of the Deniliquin Council with the surrounding Conargo Shire.[2]
Source: Edward River Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Federation (A)
A 2015 review of local government boundaries by the NSW Government Independent Pricing and Regulatory Tribunal recommended that the Corowa Shire merge with the Lockhart and Urana shires to form a new council with an area of 8,581 square kilometres (3,313 sq mi) and support a population of approximately 16,000.[3] The Council was dissolved on 12 May 2016 and along with Urana Shire the area became part of the new Federation Council [4]
Source: Federation Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Western Plains Regional (A)
The Dubbo Regional Council is a local government area located in the Central West and Orana regions of New South Wales, Australia. The council was formed on 12 May 2016 through a merger of the City of Dubbo and Wellington Council.[2]
Source: Dubbo Regional Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 7 January 2016.

Cumberland (A)
The Cumberland Council is a local government area located in the western suburbs of Sydney in the state of New South Wales, Australia. The Council was formed on 12 May 2016 from the merger of parts of the Auburn City, the former Parramatta City (Woodville Ward), and Holroyd City councils.[2][3]
Source: Cumberland Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016. Local Government (City of Parramatta and Cumberland) Proclamation 2016 [NSW] - Schedule 2 - Provisions for Cumberland Council. NSW Government. 12 May 2016. Retrieved 29 September 2017.

Georges River (A)
The Georges River Council is a local government area located in the St George region of Sydney located south of the CBD, in New South Wales, Australia. The Council was formed on 12 May 2016 from the merger of the Kogarah City Council and Hurstville City Council.[3]


Mid-Coast (A)
Mid-Coast Council is a local government area located in the Mid North Coast region of New South Wales, Australia. The council was formed on 12 May 2016 through a merger of the Gloucester Shire, Great Lakes and City of Greater Taree councils.[1]
Source: Mid-Coast Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 24 May 2016.

Gloucester (A)
A 2015 review of local government boundaries by the NSW Government Independent Pricing and Regulatory Tribunal recommended that the Gloucester Shire merge with adjoining councils. The government considered two proposals. The first proposed a merger of Gloucester Shire and Dungog Shire councils to form a new council with an area of 5,200 square kilometres (2,000 sq mi) and support a population of approximately 14,000.[6] Following the lodging of an alternate proposal by Gloucester Shire Council to amalgamate the Gloucester, Great Lakes and Greater Taree councils, the NSW Minister for Local Government proposed a merger between the Dungog Shire and City of Maitland.[7] 
Source: Mid-Coast Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 20 May 2016.

Armidale Regional (A)
Guyra Shire is the name of a former local government area located in the New England region of New South Wales, Australia. The shire was abolished on 12 May 2016, where the council, together with the Armidale Dumaresq Shire, was subsumed into the Armidale Regional Council with immediate effect.[3]
Source: Armidale Regional Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 12 May 2016.

Inner West (A)
Inner West Council is a local government area located in the inner western region of Sydney in the state of New South Wales, Australia. The Council was formed on 12 May 2016 from the forced merger of the Ashfield, Leichhardt, and Marrickville councils.[2][3]
Source: Inner West Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 15 May 2016.

Murrumbidgee (A)
Jerilderie Shire was a local government area in the Riverina region of southern New South Wales, Australia. The Shire was located adjacent to the Newell Highway. The Shire was declared in 1918 after the amalgamation of the former Municipality of Jerilderie (1889 - 1918) and Wunnamurra Shire (1906 - 1918). It was dissolved in 2016 after its amalgamation with Murrumbidgee Shire to create Murrumbidgee Council.
Source: Murrumbidgee Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Northern Beaches (A)
The Northern Beaches Council is a local government area located in the northern beaches region of Sydney, in the state of New South Wales, Australia. The Council was formed on 12 May 2016 replacing Manly, Pittwater and Warringah Councils.[2]
Source: Northern Beaches Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 12 May 2016.

Murray River (A)
The Murray River Council is a local government area in the Riverina region of New South Wales, Australia. This area was formed in 2016 from the merger of Murray Shire with Wakool Shire.[2]
Source: Murray River Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Snowy Valleys (A)
The Snowy Valleys Council is a local government area located in the South West Slopes region of New South Wales, Australia. This area was formed in 2016 from the merger of Tumbarumba Shire and Tumut Shire councils.[2]
Source: Snowy Valley Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 13 May 2016.

Queanbeyan-Palerang Regional (A)
Queanbeyan-Palerang Regional Council is a local government area located in the Southern Tablelands region of New South Wales, Australia. The council was formed on 12 May 2016 through a merger of the City of Queanbeyan and Palerang Council.[2]
Source: Queanbeyan-Palerang Regional Council. Stronger Councils. Government of New South Wales. 12 May 2016. Retrieved 21 May 2016.

Bayside 
Bayside Council is a local government area located around Botany Bay which is split between the eastern suburbs and St George areas of Sydney, located between 7 kilometres (4.3 mi) and 12 kilometres (7.5 mi) south of the CBD[3] in the state of New South Wales, Australia. The Council was formed on 9 September 2016 from the merger of the Botany Bay and the Rockdale councils.[4]
Source: Bayside Council. Stronger Councils. Government of New South Wales. 9 September 2016. Retrieved 9 September 2016.